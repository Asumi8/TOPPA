<div class="container">
  <div class="row justify-content-center">
    <div class="col-12">
      <div class = "card">
        <div class="card-body">
          <h1>Tasks List</h1>
          <p class="col-lg-12 title">- タスク一覧 -</p>

          <div class="explanation">
            <ul>
            <li><i class="bi bi-asterisk"></i>"未実行で期限まで2週間以内のタスク"は日付が赤くなり、毎週日曜日にタスクの一覧をまとめてメールで配信します</li>
            <!--<li><i class="bi bi-asterisk"></i>タスクの状況等を編集する場合は"編集"ボタンから変更ください</li>-->
            </ul>
          </div>

          <div class="row justify-content-center">
            <button class="btn btn-red col-4 ">
              <i class="fa fa-plus-square white" aria-hidden="true" style="#fff"></i>
              <%= link_to '新しいタスクを作成',  new_team_task_path(params[:team_id]), id:'rspec-task-new'%>
            </button>
          </div>


          <div class="team-reward">
            <span class="reward">
              <i class="bi bi-sun"></i>チームのご褒美/目標<i class="bi bi-sun"></i></span>
            <%= @team.reward%>
            <span class="mvp">
              <i class="bi bi-award red"></i><%= link_to 'MVPを決める', mvp_team_path(params[:team_id]), method: :get %>
            </span>
              <span class="team-info">
            <i class="bi bi-people-fill green"></i><%= link_to 'チームの詳細',  team_path(params[:team_id]) %>
            </span>
          </div>

          <div class="sort">
            <i class="bi bi-caret-down-square-fill grey"></i>
            <%= link_to "未実行のみ絞り込む", team_tasks_path(choice_status: "true")%>
            <i class="bi bi-caret-down-square-fill grey"></i>
            <%= link_to "実行状況で並び替え", team_tasks_path(sort_status: "true")%>
            <i class="bi bi-caret-down-square-fill grey"></i>
            <%= link_to "期限で並び替え", team_tasks_path(sort_expired: "true") %>
            <i class="bi bi-caret-down-square-fill grey"></i>
            <%= link_to "作成日で並び替え", team_tasks_path(sort_created: "true")%>
          </div>

          <% @tasks.each do |task| %>
            <div class="col-lg-12">
              <div class="card-task">
                <div class="card-header">
                <!--<h6 class="card-title">-->
                  <div class="left-box">
                    <span class="column category">カテゴリ</span><%= task.category.name %>
                    <span class="column name">タスク</span><span class="rspec"><%= task.name %></span>
                    <div class="icon-box">
                      <% if task.repeat == true %>
                        <label><i class="bi bi-arrow-counterclockwise"></i></label>
                      <% else %>
                        <label></label>
                      <% end %>
                      <% if task.image.present? %>
                        <label><i class="bi bi-card-image"></i></label>
                      <% else %>
                        <label></label>
                      <% end %>
                      <% if task.remarks.present? %>
                        <label><i class="bi bi-journal-text"></i></label>
                      <% else %>
                        <label></label>
                      <% end %>
                      <% if task.comments.present? %>
                        <label><i class="bi bi-chat-left-dots"></i></label>
                      <% else %>
                        <label></label>
                      <% end %>
                    </div>
                  </div>
                  <div class="right-box">
                    <span class="column create">作成日:<%= task.created_at.strftime('%Y-%m-%d') %></span>
                  </div>
                </div>
                <!--</h6>-->
                <div class="card-body task">

                  <% if task.status == true %>
                    <%= link_to task_path(id:task.id, team_id: task.team_id, task: {status: false, team_id: task.team_id}), remote: true, method: :put, class: "checkbox", id:"js-checkbox-#{task.team_id}" do %>
                    <label class = "checkbox"><%= image_tag ("icon_true_green.png")  %></label><% end %>
                  <% else %>
                    <%= link_to task_path(id:task.id, team_id: task.team_id, task: {status: true, team_id: task.team_id}), remote: true, method: :put, class: "checkbox" do %>
                    <label class = "checkbox"><%= image_tag ("icon_false_green.png")  %></label><% end %>
                  <% end %>

                  <% if (task.expired_at - @date).to_i < 14 && task.status == false %>
                      <label class="column expire">期限</label>
                      <label class="urgent"><%= task.expired_at %></label>
                    <% else %>
                      <span class="column expire">期限</span>
                      <%= task.expired_at %>
                      <% end %>
                    <% task.created_at.strftime('%Y-%m-%d') %>
                    <% count = (task.expired_at - task.created_at.to_date).to_i %>
                    <% today = (task.expired_at - @date.tomorrow).to_i %>
                    <% if count > 0 || today > 0 %>
                      <% @expired_at_count = today*100/count %>
                    <% else %>
                      <% @expired_at_count = 0 %>
                    <% end %>
                    <label for="file">
                    <progress id="file" max="100" value=<%= @expired_at_count %>></progress></label>

                  <%= link_to edit_task_path(id:task.id, team_id:task.team_id), class: "edit" do %><i class="bi bi-pencil-square"></i><% end %>
                  <%= link_to task, class: "show" do %><i class="bi bi-three-dots"></i><% end %>
                  <%= link_to task, method: :delete, data: { confirm: 'Are you sure?' }, class: "show" do %><i class="bi bi-trash3"></i><% end %>
                </div>
              </div>
            </div>
          <% end %>
          <%= paginate @tasks %>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.urgent{
  color: #F85B57;
  font-weight:bold;
}
label {
    padding-right: 10px;
    font-size: 1rem;
}
progress {
  -webkit-appearance: none;
}
::-webkit-progress-bar {
  background-color: #dadce0 ;
}
::-webkit-progress-value {
  background-color: #F85B57 ;
  }
.card{
  background-color:#ECDDD6;
  border: #fff;
}
.title{
  text-align:center;
  font-size:18px;
  color:#524f4f;
}
.card-task{
  background-color: #fff;
  margin: 10px;
  color:#50595B;
  border-radius:5px;
}
.card-body{
  color:#50595B;
}
.colmun{
  font-weight:bold;
}

.column.category{
  background-color:#5f6466;
  color:white;
  padding:2px;
  font-size:14px;
  margin-right:5px;
}
.column.name{
  background-color: #4E889A;
  color:white;
  padding:2px;
  font-size:14px;
  margin:0 5px;
}
.column.create{
  color:grey;
  padding:2px;
  font-size:14px;
  margin:0 5px;
}
.column.expire{
  background-color:#F37774;
  color:white;
  padding:2px;
  font-size:14px;
  margin-right:5px;
}
.card-header{
  display:flex;
  position:relative;
}
.left-box{
  display:flex;
}
.icon-box{
  margin-left: 10px;
  background-color:#fff;
  padding: 0 5px 0;
  height:25px;
}
.icon-box i{
  height: 50px;
}
.right-box{
  position:absolute;
  right:0;
}
.btn-secondary a{
  color:white;
}
.white{
  color:#fff;
}
.grey{
  color:grey;
}
.checkbox img{
  height:40px;
}
.checkbox img:hover{
  opacity:0.7;
}
.btn-red, .btn-red a{
  color:#fff;
}
.sort a{
  color:#638793;
}
.sort{
  margin-left:35px;
}
.team-reward{
  margin:10px 35px 20px;
  background-color:#fff;
  padding:2px 0 4px 0;
}
.reward{
  font-size:14px;
  color:#F37774;
  padding:5px;
  margin-right:5px;
}
.explanation{
  margin:10px;
  font-size:14px;
}
form{
  display:inline;
}
/* .mvp{
  background-color:#fff;
  border:1px solid #F37774;
} */
.mvp a:hover{
  opacity:0.7;
}
.mvp a{
  color:#F37774;
}
.team-info a{
  color:#59A6B0;
}
.team-info a:hover{
  opacity:0.7;
}
.red{
  color:#F37774;
}
.green{
  color:#59A6B0;
}
</style>